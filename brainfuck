#!/usr/bin/env python

# A brainfuck interpreter, written in python

import sys

if len(sys.argv) == 1:
    print "ERROR: Expected an argument."
    sys.exit(1)
else:
    source = sys.argv[1]
    try:
        f = open(source,"r")
        code = f.read()
        f.close()
    except IOError:
        code = sys.argv[1]

# Brainfuck's tape is theoretically infinite; in this case, it is a
# 30,000-cell loop
tape = [0 for x in xrange(0,30000)]
cell = 0; inputcell = 0
if len(sys.argv) > 2:
    input = sys.argv[2]

instruction = 0
while instruction < len(code):
    if code[instruction] == "+":
        tape[cell] += 1
    elif code[instruction] == "-":
        tape[cell] -= 1
    elif code[instruction] == ">":
        cell +=1
    elif code[instruction] == "<":
        cell -= 1
    elif code[instruction] == "[":
        if tape[cell] == 0:
            looplevel = 1
            while looplevel > 0:
                instruction += 1
                if code[instruction] == "[":
                    looplevel += 1
                elif code[instruction] == "]":
                    looplevel -= 1
    elif code[instruction] == "]":
        if tape[cell] != 0:
            looplevel = 1
            while looplevel > 0:
                instruction -= 1
                if code[instruction] == "[":
                    looplevel -= 1
                elif code[instruction] == "]":
                    looplevel += 1
    elif code[instruction] == ".":
        sys.stdout.write(chr(tape[cell]))
    elif code[instruction] == ",":
        if inputcell < len(input):
            tape[cell] = ord(input[inputcell])
        inputcell += 1
    else:
        pass
    instruction += 1
